<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dud Football</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{--bg:#f8fbfd;--text:#111;--link:#0366d6;--card:#fff;--muted:#6b7280}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;background:#ffffffcc;backdrop-filter:blur(6px);border-bottom:1px solid #e5e7eb}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    nav a{margin-right:1rem;color:var(--link);text-decoration:none}
    h1{margin:.2rem 0 0}
    h2{margin:1.2rem 0 .6rem}
    .card{background:var(--card);border:1px solid #e5e7eb;border-radius:12px;padding:16px}
    label{display:block;margin-top:.6rem;font-weight:600}
    input,select{width:100%;padding:.55rem;border:1px solid #d1d5db;border-radius:8px;margin-top:.25rem}
    button{margin-top:1rem;padding:.6rem 1rem;border:0;border-radius:999px;background:#0ea5e9;color:#fff;font-weight:700;cursor:pointer}
    #form-status{margin-left:.5rem;color:var(--muted)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:.55rem;border-bottom:1px solid #e5e7eb;text-align:left}
    th{color:#374151}
    .note{color:var(--muted);font-size:.95rem}
  </style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex;align-items:center;justify-content:space-between;gap:16px">
      <div>
        <h1>Dud Football</h1>
        <div class="note">Pick one QB, RB, WR, TE, K. Lowest total wins. +15 for a no-stats player.</div>
      </div>
      <nav>
        <a href="#home">Home</a>
        <a href="#week1">Week 1</a>
        <a href="#week5">Week 5</a>
        <a href="#week9">Week 9</a>
        <a href="#week13">Week 13</a>
        <a href="#week17">Week 17</a>
        <a href="#about">About</a>
      </nav>
    </div>
  </header>

  <main class="wrap" id="home" style="padding-top:16px">
    <section>
      <h2>Submit your picks</h2>
      <p class="note">Type your name and choose one player for each position. Manage the dropdowns in <code>PLAYER_LISTS</code> below.</p>
      <div class="card">
        <form id="dud-form">
          <label>Name
            <input type="text" name="name" required />
          </label>
          <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:8px">
            <label>QB <select name="qb" id="sel-qb"></select></label>
            <label>RB <select name="rb" id="sel-rb"></select></label>
            <label>WR <select name="wr" id="sel-wr"></select></label>
            <label>TE <select name="te" id="sel-te"></select></label>
          </div>
          <label style="margin-top:8px">K <select name="k" id="sel-k"></select></label>
          <div style="display:flex;align-items:center;gap:10px">
            <button type="submit">Submit picks</button>
            <span id="form-status" class="note"></span>
          </div>
        </form>
      </div>
    </section>

    <section id="week1" style="margin-top:24px">
      <h2>Week 1 Standings</h2>
      <div class="card" style="overflow:auto">
        <table id="standings">
          <thead><tr>
            <th>Rank</th><th>Name</th><th>Total</th><th>QB</th><th>RB</th><th>WR</th><th>TE</th><th>K</th>
          </tr></thead>
          <tbody></tbody>
        </table>
        <div class="note" id="mask-note" style="margin-top:8px;display:none">
          Picks are hidden until Sunday 12:00 PM ET. You’ll see “?” for player choices until then.
        </div>
      </div>
    </section>

    <section id="week5"><h2>Week 5</h2><p class="note">Coming soon.</p></section>
    <section id="week9"><h2>Week 9</h2><p class="note">Coming soon.</p></section>
    <section id="week13"><h2>Week 13</h2><p class="note">Coming soon.</p></section>
    <section id="week17"><h2>Week 17</h2><p class="note">Coming soon.</p></section>

    <section id="about">
      <h2>About</h2>
      <div class="card">
        Started around 2005: the opposite of normal fantasy—lowest score wins. +15 for a no-stats player to prevent “no-play” picks.
      </div>
    </section>
  </main>

  <script>
    // === Backend endpoints ===
    const SCRIPT_URL    = 'https://script.google.com/macros/s/AKfycbx3cE9hKzP9XjRBL15U1MnprZS_luJIRE9ib2xa_3aHlTz1Upg2eLCRIX1pS-P6ToW/exec';
    const STANDINGS_URL = SCRIPT_URL + '?view=standings';        // masked until Sunday noon ET

    // ===== Player lists you manage =====
    const PLAYER_LISTS = {
      qb: ["— Select QB —","Zach Wilson","Mac Jones","Desmond Ridder","Justin Fields"],
      rb: ["— Select RB —","AJ Dillon","Cam Akers","Najee Harris","Tyler Allgeier"],
      wr: ["— Select WR —","Allen Robinson","Chase Claypool","Kadarius Toney","DJ Chark"],
      te: ["— Select TE —","Mike Gesicki","Kyle Pitts","Cole Kmet","Tyler Conklin"],
      k:  ["— Select K —","Eddy Piñeiro","Cade York","Greg Zuerlein","Younghoe Koo"]
    };

    function fillSelect(id, arr){
      const el = document.getElementById(id);
      el.innerHTML = arr.map((name,i)=>`<option value="${i===0?'':name}" ${i===0?'disabled selected':''}>${name}</option>`).join('');
    }
    fillSelect('sel-qb', PLAYER_LISTS.qb);
    fillSelect('sel-rb', PLAYER_LISTS.rb);
    fillSelect('sel-wr', PLAYER_LISTS.wr);
    fillSelect('sel-te', PLAYER_LISTS.te);
    fillSelect('sel-k',  PLAYER_LISTS.k);

    // --- CORS-safe submit (no-cors + FormData)
    const form = document.getElementById('dud-form');
    const statusEl = document.getElementById('form-status');

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = 'Submitting…';
      try{
        const fd = new FormData(form);
        await fetch(SCRIPT_URL, { method:'POST', mode:'no-cors', body: fd });
        statusEl.textContent = 'Submitted! (check sheet)';
        form.reset();
        fillSelect('sel-qb', PLAYER_LISTS.qb);
        fillSelect('sel-rb', PLAYER_LISTS.rb);
        fillSelect('sel-wr', PLAYER_LISTS.wr);
        fillSelect('sel-te', PLAYER_LISTS.te);
        fillSelect('sel-k',  PLAYER_LISTS.k);
        try { await loadStandings(); } catch {}
      }catch(err){
        statusEl.textContent = 'Error. Try again or contact the commish.';
      }
    });

    // --- Load standings (masked until Sunday noon by the backend)
    async function loadStandings(){
      try{
        const res = await fetch(STANDINGS_URL, { cache:'no-store' });
        if(!res.ok) return;
        const rows = await res.json();
        const tbody = document.querySelector('#standings tbody');
        const maskNote = document.getElementById('mask-note');
        tbody.innerHTML = rows.map((r,i)=>`
          <tr>
            <td>${i+1}</td><td>${r.name||''}</td>
            <td><strong>${r.total||''}</strong></td>
            <td>${r.qb||''}</td><td>${r.rb||''}</td><td>${r.wr||''}</td><td>${r.te||''}</td><td>${r.k||''}</td>
          </tr>
        `).join('');
        // Show note if any row is masked
        maskNote.style.display = rows.some(r => r.qb === '?') ? 'block' : 'none';
      }catch(e){ /* if a browser blocks GET CORS, we just skip rendering */ }
    }
    loadStandings();
  </script>
</body>
</html>
