<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dud Football</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" type="image/svg+xml" href="images/dud.svg?v=3">
<meta name="theme-color" content="#0ea5e9">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@600;700;800&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">


  <!-- ========== STYLES ========== -->
  <style>
    :root{
      --bg:#f8fbfd; --text:#111; --link:#0366d6; --card:#fff; --muted:#6b7280;
      --accent:#0ea5e9; --ok:#16a34a; --chip:#eef2ff; --chipText:#1e293b;
    }

   /* Brand palette + subtle gradient for the title */
:root{
  --brand1:#0ea5e9;        /* your accent */
  --brand2:#6366f1;        /* secondary accent */
  --brand3:#14b8a6;        /* mint hint */
}

/* Header polish */
header{
  position:sticky; top:0; z-index:1000;
  background:rgba(255,255,255,.92);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
  border-bottom:1px solid #e5e7eb;
  box-shadow:0 6px 18px rgba(2,6,23,.06);
}

/* Brand block */
.brand-title{
  font-family:"Outfit",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  font-weight:800; font-size:clamp(24px,3.2vw,34px); line-height:1.05; margin:.15rem 0 .25rem;
  background:linear-gradient(90deg,var(--brand1),var(--brand2) 55%,var(--brand3));
  -webkit-background-clip:text; background-clip:text; color:transparent;
  letter-spacing:.2px;
}

.tagline{
  font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:#475569; /* slate-600 */
  font-size:clamp(13px,1.5vw,15px);
  margin:0;
}
.tagline strong{ color:var(--brand1); font-weight:700 }

/* Nav tweaks */
nav a{
  font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:#0f172a; /* slate-950 */
  font-weight:600;
  text-decoration:none;
  padding:.35rem .6rem;
  border-radius:10px;
  transition:background .2s ease, color .2s ease;
}
nav a:hover{ background:#eef2ff; color:#3730a3 } /* soft indigo hover */
 
    
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;background:#ffffffcc;backdrop-filter:blur(6px);border-bottom:1px solid #e5e7eb}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    nav a{margin-right:1rem;color:var(--link);text-decoration:none}
    h1{margin:.2rem 0 0}
    h2{margin:1.2rem 0 .6rem}
    .card{background:var(--card);border:1px solid #e5e7eb;border-radius:12px;padding:16px}
    .note{color:var(--muted);font-size:.95rem}

    .featured{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .featured .slot{
      aspect-ratio:16/9;border:1px dashed #cbd5e1;border-radius:10px;
      display:flex;align-items:center;justify-content:center;color:#94a3b8;background:#fff;
    }
    .featured .slot img{width:100%;height:100%;object-fit:cover;border-radius:10px}

    /* Compact form grid */
    form.compact{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    form.compact .full{grid-column:1 / -1}
    label{font-weight:600;font-size:.95rem}
    input,select{width:100%;padding:.5rem;border:1px solid #d1d5db;border-radius:8px;margin-top:.25rem}
    button{padding:.6rem 1rem;border:0;border-radius:999px;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    #form-status{margin-left:.6rem;color:var(--muted)}

    /* Player chips */
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .chip{padding:.45rem .7rem;border-radius:999px;background:#eef2ff;color:#1e293b;border:1px solid #c7d2fe;font-weight:600;font-size:.9rem}
    .chip.submitted{background:#ecfdf5;border-color:#86efac;color:#166534}
    .chip.submitted::after{content:" ✓";color:#16a34a;font-weight:900}

    /* Standings table */
    #standings-wrap{display:none}
    table{width:100%;border-collapse:collapse}
    th,td{padding:.55rem;border-bottom:1px solid #e5e7eb;text-align:left}
    th{color:#374151}

    /* Controls + status */
    .controls{display:flex;gap:10px;align-items:center;margin:.5rem 0}
    .statusbar{margin:10px 0 0;color:#64748b;font-size:.9rem}
    .statusbar.ok{color:#0f766e}
    .statusbar.warn{color:#b45309}

    /* Custom autocomplete dropdown for Name */
    .ac-wrap{position:relative}
    .ac-list{
      position:absolute; z-index:10; left:0; right:0; top:100%;
      background:#fff; border:1px solid #d1d5db; border-radius:8px; margin-top:4px;
      box-shadow:0 8px 24px rgba(0,0,0,.08); max-height:220px; overflow:auto; display:none;
    }
    .ac-item{padding:.5rem .7rem; cursor:pointer}
    .ac-item:hover, .ac-item.active{background:#f1f5f9}

    /* Two-column layout: form (2/3) + chips (1/3) on desktop; stacked on mobile */
    .twocol { display:grid; grid-template-columns: 2fr 1fr; gap:16px; }
    @media (max-width: 900px){ .twocol { grid-template-columns: 1fr; } }

    /* Mobile tweaks */
    @media (max-width:700px){
      .featured{grid-template-columns:1fr 1fr}
      form.compact{grid-template-columns:1fr}
    }

    /* Prominent reveal message that looks like the table section */
.reveal-card.card{
  display:flex; align-items:center; gap:16px;
  padding:20px 18px;
}
.reveal-icon{
  flex:0 0 44px; width:44px; height:44px;
  display:grid; place-items:center;
  border-radius:999px;
  background:#fee2e2; color:#b91c1c; /* soft red lock bubble */
  font-size:22px; line-height:1;
}
.reveal-card h3{
  margin:0 0 6px; font-size:1.125rem; /* 18px */
}
.reveal-card p{
  margin:0; font-size:1.05rem; color:#334155;
}
.reveal-card p strong{ font-weight:800; }

/* ---------- Global polish ---------- */
:root{
  --bg:#f7fafc;            /* slightly brighter */
  --card:#ffffff;
  --border:#e5e7eb;
  --shadow:0 10px 25px rgba(2,6,23,.06), 0 2px 8px rgba(2,6,23,.04);
  --muted:#64748b;
  --ink:#0f172a;
  --accent:#0ea5e9;
  --accent-ink:#075985;
  --ok:#16a34a;
}
body{color:var(--ink)}
.card{border:1px solid var(--border); box-shadow:var(--shadow)}
h2.section-title{
  margin:20px 0 8px; font-size:1.25rem; letter-spacing:.2px;
  display:flex; align-items:center; gap:.6rem;
}
h2.section-title::after{
  content:""; flex:1 1 auto; height:1px; background:linear-gradient(90deg,#e2e8f0,transparent);
}

/* ---------- Buttons ---------- */
button, .btn{
  padding:.66rem 1rem; border-radius:999px; border:0;
  background:linear-gradient(180deg,#38bef5,#0ea5e9);
  color:#fff; font-weight:700; box-shadow:0 6px 14px rgba(14,165,233,.25);
  transition:transform .08s ease, filter .2s ease;
}
button:hover{transform:translateY(-1px); filter:brightness(1.02)}
button:active{transform:translateY(0)}

/* ---------- Form tightening ---------- */
form.compact label{font-weight:600; color:#0f172a}
input,select{
  background:#fff; border:1px solid var(--border); border-radius:10px;
}
select{appearance:none; background-image:url("data:image/svg+xml,%3Csvg width='18' height='18' viewBox='0 0 20 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M6 8l4 4 4-4' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:right .7rem center; padding-right:2rem}

/* ---------- Chips (player check-in) ---------- */
.chip{background:#eef2ff; color:#1e293b; border:1px solid #c7d2fe}
.chip.submitted{background:#ecfdf5; border-color:#86efac; color:#166534}
.chips{gap:10px}

/* ---------- Standings table ---------- */
#standings-wrap table{border-radius:10px; overflow:hidden}
#standings thead th{background:#f8fafc}
#standings tbody tr:nth-child(odd){background:#fcfdff}

/* ---------- Reveal card (you already added) ---------- */
.reveal-card.card{display:flex; align-items:center; gap:16px; padding:22px 18px}
.reveal-icon{flex:0 0 44px; width:44px; height:44px; display:grid; place-items:center; border-radius:999px; background:#fee2e2; color:#b91c1c; font-size:22px}

/* ---------- Featured Matches (new) ---------- */
.match-grid{
  display:grid; grid-template-columns:repeat(4,minmax(0,1fr)); gap:12px;
}
.match-card{
  position:relative; border-radius:14px; overflow:hidden; background:#fff; border:1px solid var(--border);
  box-shadow:var(--shadow); isolation:isolate;
}
.match-card img{width:100%; height:112px; object-fit:cover; display:block}
.match-overlay{
  position:absolute; inset:auto 0 0 0; padding:10px 12px;
  background:linear-gradient(180deg,rgba(2,6,23,0) 0%, rgba(2,6,23,.6) 70%, rgba(2,6,23,.75) 100%);
  color:#fff; font-size:.92rem; line-height:1.2;
}
.match-meta{opacity:.9; font-size:.8rem}

/* ---------- Optional system dark mode ---------- */
@media (prefers-color-scheme: dark){
  :root{ --bg:#0b1221; --card:#0f172a; --border:#1f2937; --ink:#e5e7eb; --muted:#9aa4b2; --shadow:none }
  body{background:radial-gradient(1200px 600px at 50% -200px,#0e1b34,#0b1221)}
  .note{color:#9aa4b2}
  .match-card{background:#111827}
  #standings thead th{background:#0b1422}
  #standings tbody tr:nth-child(odd){background:#0f1a2b}
}

    /* Title icons (emoji or inline svg) */
.section-title{ display:flex; align-items:center; gap:.6rem }
.title-icon{
  width:34px; height:34px; border-radius:10px;
  display:grid; place-items:center;
  font-size:18px; line-height:1;
  box-shadow:0 6px 18px rgba(2,6,23,.06);
}
.title-icon.blue  { background:#e0f2fe; color:#075985; } /* accent */
.title-icon.green { background:#dcfce7; color:#166534; } /* success */

    /* Keep the header above everything when scrolling */
header{
  position: sticky;          /* you already had this */
  top: 0;
  z-index: 1000;             /* <- key line */
  background: rgba(255,255,255,.92);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border-bottom: 1px solid #e5e7eb;
  box-shadow: 0 6px 18px rgba(2,6,23,.06);
}

/* Make sure content sits beneath the header in the stacking order */
.featured, .match-grid, .match-card, main, .card, #standings-wrap{
  position: relative;
  z-index: 0;
}

    /* --- Dud Report --- */
.h2-withicon{
  display:flex; align-items:center; gap:10px;
  margin: 0 0 .75rem 0;
}
.h2-withicon svg{
  width:22px; height:22px; color:var(--accent);
  flex:0 0 auto;
}

    
  </style>
</head>
<body>
<header>
  <div class="wrap" style="display:flex;align-items:center;justify-content:space-between;gap:16px">
    <div>
      <h1 class="brand-title">Dud Football</h1>
      <p id="tagline" class="tagline">
  Pick one QB, RB, WR, TE, K. Lowest total wins. <strong>+15</strong> for a no-stats player.
</p>

    </div>
    <nav>
      <a href="#home">Home</a>
    </nav>
  </div>



</header>


<main class="wrap" id="home" style="padding-top:16px">
  <!-- ========== FEATURED GAMES ========== -->
  <section class="card">

  <h2 class="section-title">
  <span class="title-icon blue" aria-hidden="true">🏈</span>
  Featured Games
</h2>

<div class="match-grid">
  <a class="match-card" href="#week1" aria-label="Cowboys at Eagles">
    <img src="images/cowboys_eagles.png?v=1" alt="Cowboys @ Eagles">
    <div class="match-overlay">
      <div><strong>Cowboys @ Eagles</strong></div>
      <div class="match-meta">Thu • 7:20 PM</div>
    </div>
  </a>

  <a class="match-card" href="#week1" aria-label="Chiefs at Chargers">
    <img src="images/chiefs_chargers.png?v=1" alt="Chiefs @ Chargers">
    <div class="match-overlay">
      <div><strong>Chiefs @ Chargers</strong></div>
      <div class="match-meta">Fri • 7:00 PM</div>
    </div>
  </a>

  <a class="match-card" href="#week1" aria-label="Lions at Packers">
    <img src="images/packers_lions.png?v=1" alt="Lions @ Packers">
    <div class="match-overlay">
      <div><strong>Lions @ Packers</strong></div>
      <div class="match-meta">Sun • 3:25 PM</div>
    </div>
  </a>

  <a class="match-card" href="#week1" aria-label="Bears at Vikings">
    <img src="images/bears_vikings.png?v=1" alt="Bears @ Vikings">
    <div class="match-overlay">
      <div><strong>Bears @ Vikings</strong></div>
      <div class="match-meta">Mon • 7:15 PM</div>
    </div>
  </a>
</div>
    
  </section>

  <!-- ========== TWO-COLUMN: FORM + CHECK-IN ========== -->
  <section class="twocol" style="margin-top:18px">
    <!-- Left: Submit picks -->
    <div>
        <h2 class="section-title">
      <span class="title-icon blue" aria-hidden="true">📝</span>
      Submit your picks
    </h2>

      <!-- New home for the players list status -->
    <div id="players-status" class="statusbar" style="display:none; margin:.25rem 0 .5rem"></div>
      
      <div class="card">
        <form id="dud-form" class="compact">
          <!-- Name with custom autocomplete -->
          <div class="full ac-wrap">
            <label>Name
              <input type="text" name="name" id="name-input" autocomplete="off" required />
            </label>
            <div id="ac-list" class="ac-list"></div>
          </div>

          <!-- Position dropdowns (populated from players.json or fallback) -->
          <label>QB <select name="qb" id="sel-qb"></select></label>
          <!-- Other QB write-in -->
          <div class="full" id="qb-other-wrap" style="display:none">
            <label>Other QB
              <input type="text" id="qb-other" placeholder="e.g., Blaine Gabbert (KC)">
            </label>
          </div>

          <label>RB <select name="rb" id="sel-rb"></select></label>
          <!-- Other RB write-in -->
          <div class="full" id="rb-other-wrap" style="display:none">
            <label>Other RB
              <input type="text" id="rb-other" placeholder="e.g., Veteran RB (DET)">
            </label>
          </div>

          <label>WR <select name="wr" id="sel-wr"></select></label>
          <!-- Other WR write-in -->
          <div class="full" id="wr-other-wrap" style="display:none">
            <label>Other WR
              <input type="text" id="wr-other" placeholder="e.g., Practice WR (GB)">
            </label>
          </div>

          <label>TE <select name="te" id="sel-te"></select></label>
          <!-- Other TE write-in -->
          <div class="full" id="te-other-wrap" style="display:none">
            <label>Other TE
              <input type="text" id="te-other" placeholder="e.g., Call-up TE (MIN)">
            </label>
          </div>

          <div class="full">
            <label>K <select name="k" id="sel-k"></select></label>
          </div>
          <!-- Other K write-in -->
          <div class="full" id="k-other-wrap" style="display:none">
            <label>Other K
              <input type="text" id="k-other" placeholder="e.g., Emergency K (PHI)">
            </label>
          </div>

          <!-- Submit controls -->
          <div class="full controls">
            <button type="submit">Submit picks</button>
            <span id="form-status" class="note"></span>
          </div>

          <!-- Record the week number with each submission -->
          <input type="hidden" name="week" id="week-field" />
        </form>
      </div>
    </div>

    <!-- Right: Player check-ins -->
    <aside>
   <h2 class="section-title">
      <span class="title-icon green" aria-hidden="true">👥</span>
      Player check-in
    </h2>
      <div class="card">
        <div class="note">Green = submitted this week</div>
        <div id="chips" class="chips"></div>
      </div>
    </aside>
  </section>

  <!-- ========== STANDINGS (AUTO-REVEAL AT NOON CENTRAL) ========== -->
  <!-- BIG notice card shown while picks are hidden -->
  <div id="reveal-note" class="card reveal-card" role="status" aria-live="polite">
    <div class="reveal-icon">🔒</div>
    <div>
      <h3>Standings locked</h3>
      <p>Picks will be revealed at <strong>Noon Central</strong> on Sunday.</p>
    </div>
  </div>

  <div id="last-update" class="note" style="display:none; margin:8px 0 10px;"></div>
  
   <div id="standings-wrap" class="card" style="overflow:auto; display:none">
    <table id="standings">
      <thead>
        <tr>
          <th>#</th><th>Name</th>
          <th>Total</th>
          <th>QB</th>
          <th>QB Pts</th>
          <th>RB</th>
          <th>RB Pts</th>
          <th>WR</th>
          <th>WR Pts</th>
          <th>TE</th>
          <th>TE Pts</th>
          <th>K</th>
          <th>K Pts</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<section id="dud-report" class="card" style="margin-top:18px">
  <h2 class="h2-withicon">
    <!-- simple inline newspaper icon -->
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <rect x="3" y="4" width="18" height="16" rx="2" ry="2" stroke="currentColor" fill="none" stroke-width="1.6"/>
      <rect x="6" y="7" width="6" height="4" rx="1" stroke="currentColor" fill="none" stroke-width="1.6"/>
      <line x1="13" y1="8" x2="18" y2="8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
      <line x1="13" y1="11" x2="18" y2="11" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
      <line x1="6" y1="14" x2="18" y2="14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
      <line x1="6" y1="17" x2="18" y2="17" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
    </svg>
    The Dud Report
  </h2>
<p> Oh, we're back baby. And with no shortage of dudly advice.  </p>
    <p style="color: purple;">   
    <b>QB</b>: All the signs point to JJ McCarthy <b>(MIN) </b>actually going under center in 2025 having
   stolen the job from Sam Darnold. Darnold, who treated the purple fandom to 9 sacks 
   in <a href="https://www.youtube.com/watch?v=xEARrESCz6k&t=4s">this</a> playoff game just 9 months ago. Yowzas. Also, credit to Connor Stallions for stealing 
   these QB signs. TBH, we were gonna win this dud report with or without him. </p>
    <p style="color: red;"> 
   <b>RB</b>: Try Elijah Mitchell <b>(KC)</b>, the Chiefs’ RB3 in our players.json file
   <i> (suck it Blatti, I know what a json is now)</i>. You'll be watching watching Pacheco/Hunt 
   hog the real work as the Chief evaluate whether or not to have an offense again 
   this season, or continue to make T.Swift the focal point. 
    Meanwhile, expect that Mitchell logs a couple carries and a 
   safety-valve catch. Think Cubs offense in August: runners everywhere, 
   nothing crossing home.</p>
  <p style="color: navy;"> 
    <b>TE</b>: Cole Kmet <b>(CHI)</b> will play second fiddle with rookie Colston Loveland 
    hogging all the red-zone looks. That’s <strong>bourbon-sipping bliss</strong>: chip blocks, 
    a lonely curl, seven yards, and no end zone in sight. Cole Kmet is our DUD LOCK OF THE WEEK ™.
  </p>
  <p> It's Dud season. Nothing could be better. <i>Well, unless sacks were still 
  worth -2. Stupid dud summit parlimentary procedures. </i>
  </p>
  
</section>

  
  <!-- About -->
  <section id="about" style="margin:18px 0 36px">
    <h2>About</h2>
    <div class="card">
   Dud Football © 2025 · Providing 4th quarter mayhem to Jay Muench since 2008 (#YamonFigures)
    </div>
  </section>
</main>

<!-- ========== SCRIPTS ========== -->
<script>

function setRandomTagline() {
  const TAGLINES = [
    'Weekly fun for only $1',
    '@DanAdams, make yer damn picks!',
    'Season XVIII. <b>Without Delzell.</b>',
    'Now with live scoring!',
    'Richards: Silent, but dudly',
    'We made <mark>Lawrence Vickers</mark> famous!',
    'Mediocrity, <u>underrated</u>. Negativity, <u>appreciated</u>.',
    'Celebrating fumbles, always.',
    'Benchwarmers welcome.',
    '🏈 Make <s>good</s> bad choices 🏈',
    'Try the dud raid.',
    'Whose your <b>dud</b>dy?',
    'Now with live scoring!',
    'We 🧡 the NFC East.',
    'p.s. Huntley sucks',
    'Sacks should still be -2 🤦🏼',
    'Dud-riffic since 08.',
    'We got <b>Goni</b>... how bout you?',
    'Points are bad. Be good at bad.', 
    'PythaGaris therom. Dud² = Fun²'  
  ];
  const el = document.getElementById('tagline');
  if (!el) return;
  const t = TAGLINES[Math.floor(Math.random() * TAGLINES.length)];
  el.innerHTML = t;            // use innerHTML so <s> renders
}


  
  /* =========================
     CONFIG: back-end endpoints
     ========================= */
  const SCRIPT_URL    = 'https://script.google.com/macros/s/AKfycbwf8Hmg5xvvyg60A12-v9MBLs_pCZKtEsUtLL9MiYXNfT_0UKYK2bxPTk0WC9AuuRA/exec';
  const STANDINGS_URL = SCRIPT_URL + '?view=standings';

  // (Legacy single-CSV fallback; site now uses WEEK_CSV below if present)
  const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSldDkrQHAfBel9ImfzVJ9ZxYV9I9yNikKrRAjChBmktW7nU6BZchcVMsntpeh3rAztzi0-1QKR5QqQ/pub?gid=0&single=true&output=csv';

  /* =========================
     WEEK & REVEAL SCHEDULE
     - Change ?week= in URL to switch (e.g., ?week=5)
     - FORCE_REVEAL with ?reveal=1 to test
     ========================= */
  const ACTIVE_WEEK = (new URLSearchParams(location.search).get('week') || '1');
  const FORCE_REVEAL = new URLSearchParams(location.search).has('reveal');

  // Per-week CSV links (Publish to web → that week's "submissions" → CSV)
  const WEEK_CSV = {
    '1': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSldDkrQHAfBel9ImfzVJ9ZxYV9I9yNikKrRAjChBmktW7nU6BZchcVMsntpeh3rAztzi0-1QKR5QqQ/pub?gid=0&single=true&output=csv',
    '5': '',  // TODO: paste week 5 CSV
    '9': '',  // TODO
    '13':'',  // TODO
    '17':''   // TODO
  };
  function csvUrl(){ return WEEK_CSV[ACTIVE_WEEK] || CSV_URL || ''; }

  // Noon Central (America/Chicago) for each game week (update dates per season)
  const REVEAL_SCHEDULE = {
    '1':  '2025-09-07T12:00:00-05:00', // Week 1 (CDT)
    '5':  '2025-10-05T12:00:00-05:00', // Week 5 (CDT)
    '9':  '2025-11-02T12:00:00-06:00', // Week 9 (CST starts)
    '13': '2025-11-30T12:00:00-06:00', // Week 13
    '17': '2025-12-28T12:00:00-06:00'  // Week 17
  };
  function isRevealedNow(){
    if (FORCE_REVEAL) return true;           // test override with ?reveal=1
    const iso = REVEAL_SCHEDULE[ACTIVE_WEEK];
    if (!iso) return false;
    return Date.now() >= new Date(iso).getTime();
  }
  async function applyRevealGate(){
    const note = document.getElementById('reveal-note');
    const tableWrap = document.getElementById('standings-wrap');
    if (isRevealedNow()){
      note.style.display = 'none';
      tableWrap.style.display = 'block';
      // load standings once visible
      const rows = await fetchStandings();
      renderStandings(rows);
      updateLastUpdatedFromRows(rows); 
    }else{
      note.style.display = 'block';
      tableWrap.style.display = 'none';
    }
  }
  // Re-check every 2s to flip exactly at reveal time
  setInterval(applyRevealGate, 2000);

  /* =========================
     QUALITY OF LIFE
     - Persist last typed name
     ========================= */
  (function persistName() {
    const saved = localStorage.getItem('df_name') || '';
    const input = document.getElementById('name-input');
    if (input && saved) input.value = saved;
    input?.addEventListener('input', () => {
      localStorage.setItem('df_name', (input.value || '').trim());
    });
  })();

  /* =========================
     VALIDATION & NORMALIZATION
     ========================= */
  function validatePicks() {
    const need = [['sel-qb','QB'],['sel-rb','RB'],['sel-wr','WR'],['sel-te','TE'],['sel-k','K']];
    for (const [id,label] of need) {
      const v = document.getElementById(id)?.value || '';
      if (!v) return `Please select a ${label}.`;
    }
    // If “Other…” chosen for any, enforce the write-in
    const pairs = [
      ['sel-qb','qb-other','QB'],
      ['sel-rb','rb-other','RB'],
      ['sel-wr','wr-other','WR'],
      ['sel-te','te-other','TE'],
      ['sel-k','k-other','K'],
    ];
    for (const [selId,inputId,label] of pairs){
      if (document.getElementById(selId)?.value === 'other' &&
          !(document.getElementById(inputId)?.value || '').trim()){
        return `Please type the other ${label}.`;
      }
    }
    const nm = (document.getElementById('name-input')?.value || '').trim();
    if (!nm) return 'Please enter your name.';
    return '';
  }
  function norm(s){ return (s||'').toLowerCase().replace(/\s+/g,' ').trim(); }

  /* =========================
     ROSTER (chips + autocomplete)
     ========================= */
  const ROSTER = [
    'David Cook',
    'Al Kremer','Adam McCloud','Chad Neff','Chris Gotsch','Dan Adams','Devin Hester',
    'Doug Blatti','Eric Chandler','Jason Muench','Jeremy Palese','Jim Altendorf',
    'Mark Anderson','Matt Rogers','Michael Arrigoni','Matt Richards',
    'Ryan Brunswick','Ryan Slattery','PythaGaris','Will Peterson'
  ];

  /* =========================
     PLAYERS LISTS (dropdowns)
     - Loads players.json; falls back if missing
     - QB/K use starters-only (+ Other…); RB/WR/TE show full list (+ Other…)
     ========================= */
  const FALLBACK_LISTS = {
    qb: ['— Select QB —','Zach Wilson','Mac Jones','Desmond Ridder','Justin Fields'],
    rb: ['— Select RB —','AJ Dillon','Cam Akers','Najee Harris','Tyler Allgeier'],
    wr: ['— Select WR —','Allen Robinson','Chase Claypool','Kadarius Toney','DJ Chark'],
    te: ['— Select TE —','Mike Gesicki','Kyle Pitts','Cole Kmet','Tyler Conklin'],
    k:  ['— Select K —','Eddy Piñeiro','Cade York','Greg Zuerlein','Younghoe Koo']
  };
  let LOADED_LISTS = null;
 function setPlayersStatus(text, cls){
  const el = document.getElementById('players-status');
  if (!el) return;               // <-- guard so no element = no crash
  el.style.display = 'block';
  el.textContent = text;
  el.className = 'statusbar ' + (cls || '');
}

  async function loadPlayersJson(){
    const candidates = [
      'players.json?v=' + Date.now(),
      location.origin + location.pathname.replace(/index\.html?$/,'') + 'players.json?v=' + Date.now()
    ];
    for (const url of candidates){
      try{
        const res = await fetch(url, {cache:'no-store'});
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        const pos = data.positions || {};
        const withPH = (arr, label)=> ['— Select ' + label + ' —', ...(arr||[])];
        LOADED_LISTS = {
          qb: withPH(pos.qb, 'QB'),
          rb: withPH(pos.rb, 'RB'),
          wr: withPH(pos.wr, 'WR'),
          te: withPH(pos.te, 'TE'),
          k:  withPH(pos.k,  'K')
        };
        setPlayersStatus('Loaded players from players.json', 'ok');
        return;
      }catch(e){ /* try next candidate */ }
    }
    LOADED_LISTS = FALLBACK_LISTS;
    setPlayersStatus('Using built-in player lists (players.json not found or invalid).', 'warn');
  }

  // Keep only the first QB/K per team (assumes starters come first in players.json)
  function startersOnly(list, label){
    const out = ['— Select ' + label + ' —'];
    const seen = new Set();
    for (const item of (list || []).slice(1)) { // skip placeholder
      const m = item && item.match(/\(([^)]+)\)\s*$/); // "Name (TEAM)" -> TEAM
      const team = m ? m[1] : '';
      if (!team || !seen.has(team)) { seen.add(team); out.push(item); }
    }
    out.push('Other…'); // sentinel
    return out;
  }

  // Standard select filler with 'Other…' sentinel support
  function fillSelect(id, arr){
    const el = document.getElementById(id);
    el.innerHTML = (arr || []).map((name,i)=>{
      const isPH = (i===0);
      const val  = (name === 'Other…') ? 'other' : (isPH ? '' : name);
      const attrs = [ `value="${val.replace(/"/g,'&quot;')}"`, isPH ? 'disabled selected' : '' ].join(' ');
      return `<option ${attrs}>${name}</option>`;
    }).join('');
  }

  // Append 'Other…' to a full list (ensuring placeholder exists)
  function withOther(list, label){
    const base = list?.slice() || [];
    if (!base.length || !/^— Select /.test(base[0])) base.unshift('— Select ' + label + ' —');
    if (base[base.length-1] !== 'Other…') base.push('Other…');
    return base;
  }

  // Show write-in input when 'Other…' is chosen
  function wireOtherToggle(selectId, wrapId, inputId){
    const sel = document.getElementById(selectId);
    const wrap = document.getElementById(wrapId);
    const input = document.getElementById(inputId);
    function update(){
      const isOther = sel.value === 'other';
      wrap.style.display = isOther ? 'block' : 'none';
      if (input) input.required = isOther;
      if (!isOther && input) input.value = '';
    }
    sel.addEventListener('change', update);
    update();
  }

  // Build all dropdowns
  async function paintDropdowns(){
    if (!LOADED_LISTS) await loadPlayersJson();

    // QB/K = starters-only + Other… ; RB/WR/TE = full list + Other…
    const qbList = startersOnly(LOADED_LISTS.qb || [], 'QB');
    const kList  = startersOnly(LOADED_LISTS.k  || [], 'K');

    fillSelect('sel-qb', qbList);
    fillSelect('sel-rb', withOther(LOADED_LISTS.rb, 'RB'));
    fillSelect('sel-wr', withOther(LOADED_LISTS.wr, 'WR'));
    fillSelect('sel-te', withOther(LOADED_LISTS.te, 'TE'));
    fillSelect('sel-k',  kList);

    // Wire the revealers for all five
    wireOtherToggle('sel-qb','qb-other-wrap','qb-other');
    wireOtherToggle('sel-rb','rb-other-wrap','rb-other');
    wireOtherToggle('sel-wr','wr-other-wrap','wr-other');
    wireOtherToggle('sel-te','te-other-wrap','te-other');
    wireOtherToggle('sel-k','k-other-wrap','k-other');
  }

  /* =========================
     NAME AUTOCOMPLETE (custom)
     ========================= */
  const nameInput = document.getElementById('name-input');
  const acList = document.getElementById('ac-list');
  let acIndex = -1;
  function showSuggestions(items){
    if (!items.length){ acList.style.display='none'; return; }
    acList.innerHTML = items.map((n,i)=>`<div class="ac-item${i===0?' active':''}" data-name="${n}">${n}</div>`).join('');
    acList.style.display = 'block';
    acIndex = 0;
  }
  function hideSuggestions(){ acList.style.display='none'; acIndex=-1; }
  function currentSuggestions(){ return Array.from(acList.querySelectorAll('.ac-item')); }
  nameInput.addEventListener('input', () => {
    const q = nameInput.value.trim().toLowerCase();
    if (!q){ hideSuggestions(); return; }
    const hits = ROSTER.filter(n => n.toLowerCase().includes(q)).slice(0, 8);
    showSuggestions(hits);
  });
  nameInput.addEventListener('focus', () => {
    const q = nameInput.value.trim().toLowerCase();
    const hits = q ? ROSTER.filter(n => n.toLowerCase().includes(q)).slice(0,8) : ROSTER.slice(0,8);
    showSuggestions(hits);
  });
  document.addEventListener('click', (e)=>{ if (!e.target.closest('.ac-wrap')) hideSuggestions(); });
  acList.addEventListener('click', (e)=>{
    const it = e.target.closest('.ac-item'); if (!it) return;
    nameInput.value = it.dataset.name;
    hideSuggestions();
  });
  nameInput.addEventListener('keydown', (e)=>{
    const items = currentSuggestions(); if (!items.length) return;
    if (e.key==='ArrowDown'){ e.preventDefault(); acIndex = Math.min(acIndex+1, items.length-1); items.forEach((el,i)=>el.classList.toggle('active', i===acIndex)); }
    if (e.key==='ArrowUp'){ e.preventDefault(); acIndex = Math.max(acIndex-1, 0); items.forEach((el,i)=>el.classList.toggle('active', i===acIndex)); }
    if (e.key==='Enter'){ if (acIndex>=0){ e.preventDefault(); nameInput.value = items[acIndex].dataset.name; hideSuggestions(); } }
    if (e.key==='Escape'){ hideSuggestions(); }
  });

  /* =========================
     CHIPS (render + instant/persistent green)
     ========================= */
  function renderChips(submittedSet=new Set()){
    const box = document.getElementById('chips');
    box.innerHTML = ROSTER.map(n=>{
      const submitted = submittedSet.has(norm(n));
      return `<span class="chip ${submitted?'submitted':''}">${n}</span>`;
    }).join('');
  }
  function markChipAsSubmitted(name){
    if (!name) return;
    const target = norm(name);
    const container = document.getElementById('chips');
    [...container.querySelectorAll('.chip')].forEach(chip=>{
      if (norm(chip.textContent) === target){
        chip.classList.add('submitted');
      }
    });
  }
  // Local optimistic cache per week
  const LS_KEY = 'df_submitted_' + String(ACTIVE_WEEK);
  function loadOptimisticMarks(){
    try{
      const list = JSON.parse(localStorage.getItem(LS_KEY) || '[]');
      list.forEach(n => markChipAsSubmitted(n));
    }catch{}
  }
  function rememberSubmitted(name){
    try{
      const set = new Set(JSON.parse(localStorage.getItem(LS_KEY) || '[]'));
      set.add(norm(name));
      localStorage.setItem(LS_KEY, JSON.stringify([...set]));
    }catch{}
  }

  /* =========================
     STANDINGS (CSV-first; Apps Script fallback)
     ========================= */
async function fetchStandings(){
  try{
    const url = csvUrl();
    if (url){
      const bust = (url.includes('?') ? '&' : '?') + 't=' + Date.now();
      const res = await fetch(url + bust, {cache:'no-store'}); if(!res.ok) throw 0;
      const text = await res.text();
      const lines = text.trim().split(/\r?\n/);
      if (!lines.length) return [];

      // headers + helpers
      const hdr = lines[0].split(',');
      const idx  = (h) => hdr.indexOf(h);
      const get  = (cols, h) => { const i = idx(h); return i > -1 ? cols[i] : ''; };
      const toNum = (v) => { const n = parseFloat(v); return isNaN(n) ? 0 : n; };

      // Prefer "Canonical Name" if present; fall back to "name"
      const nameIdx = idx('Canonical Name') > -1 ? idx('Canonical Name') : idx('name');

      // Build rows safely (guard missing columns)
      const rows = lines.slice(1).map(line => {
        const cols = line.split(',');

        const qb_pts = get(cols,'qb_pts'), rb_pts = get(cols,'rb_pts'),
              wr_pts = get(cols,'wr_pts'), te_pts = get(cols,'te_pts'),
              k_pts  = get(cols,'k_pts');

        let total = get(cols,'total');
        if (!total) total = (toNum(qb_pts)+toNum(rb_pts)+toNum(wr_pts)+toNum(te_pts)+toNum(k_pts)).toString();

        return {
          name: (nameIdx > -1 ? cols[nameIdx] : '') || '',
          qb:   get(cols,'qb'), rb: get(cols,'rb'), wr: get(cols,'wr'),
          te:   get(cols,'te'), k:  get(cols,'k'),
          qb_pts, rb_pts, wr_pts, te_pts, k_pts,
          total,
          last_live_update: get(cols,'last_live_update')
        };
      }).filter(r => r.name);

      // 🔑 Enforce numeric sort (low → high)
      rows.sort((a,b) => toNum(a.total) - toNum(b.total));

      return rows;
    }else{
      // Apps Script JSON fallback
      const res = await fetch(STANDINGS_URL, {cache:'no-store'}); if(!res.ok) throw 0;
      const rows = await res.json();
      // Also sort fallback data just in case
      const toNum = (v) => { const n = parseFloat(v); return isNaN(n) ? 0 : n; };
      rows.sort((a,b) => toNum(a.total) - toNum(b.total));
      return rows;
    }
  }catch(e){
    console.error('fetchStandings error', e);
    return [];
  }
}

  function renderStandings(rows){
    const tbody = document.querySelector('#standings tbody');
    tbody.innerHTML = rows.map((r,i)=>`
      <tr>
        <td>${i+1}</td>
        <td>${r.name||''}</td>
        <td><strong>${r.total||''}</strong></td>

        <td>${r.qb||''}</td><td>${r.qb_pts||''}</td>
        <td>${r.rb||''}</td><td>${r.rb_pts||''}</td>
        <td>${r.wr||''}</td><td>${r.wr_pts||''}</td>
        <td>${r.te||''}</td><td>${r.te_pts||''}</td>
        <td>${r.k||''}</td><td>${r.k_pts||''}</td>
      </tr>
    `).join('');
  }

  function updateLastUpdatedFromRows(rows){
  const el = document.getElementById('last-update');
  if (!el) return;

  const parse = (s) => {
    const str = String(s || '').trim();
    if (!str) return null;
    const d1 = new Date(str);
    if (!isNaN(d1)) return d1;
    const m = str.match(/(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\s+(\d{1,2}):(\d{2})/);
    if (m){
      let [, mm, dd, yyyy, HH, MM] = m;
      yyyy = yyyy ? (yyyy.length === 2 ? '20' + yyyy : yyyy) : String(new Date().getFullYear());
      return new Date(Number(yyyy), Number(mm)-1, Number(dd), Number(HH), Number(MM));
    }
    return null;
  };

  let max = null;
  for (const r of rows){
    const d = parse(r.last_live_update);
    if (d && (!max || d > max)) max = d;
  }

  if (!max){
    el.style.display = 'none';
    return;
  }

  const pad = n => String(n).padStart(2,'0');
  const mm = pad(max.getMonth()+1);
  const dd = pad(max.getDate());
  const HH = pad(max.getHours());
  const MM = pad(max.getMinutes());

  el.textContent = `Last updated: ${mm}/${dd} ${HH}:${MM}`;
  el.style.display = 'block';
}

  
  /* =========================
     SUBMIT HANDLER
     - Instant green + remember
     - POST to Apps Script
     - Replace 'Other…' with write-in values
     - Sync from CSV
     ========================= */
  const form = document.getElementById('dud-form');
  const statusEl = document.getElementById('form-status');
  form?.addEventListener('submit', async (e)=>{
    e.preventDefault();

    const err = validatePicks();
    if (err) { statusEl.textContent = err; return; }

    statusEl.textContent = 'Submitting…';
    const nameJustSubmitted = (nameInput.value || '').trim();

    // Instant feedback + persist locally
    markChipAsSubmitted(nameJustSubmitted);
    rememberSubmitted(nameJustSubmitted);

    try{
      const fd = new FormData(form);

      // Replace any 'other' selections with the write-in text
      const map = [
        ['qb','qb-other'],
        ['rb','rb-other'],
        ['wr','wr-other'],
        ['te','te-other'],
        ['k','k-other'],
      ];
      for (const [field, inputId] of map){
        if (fd.get(field) === 'other') {
          fd.set(field, (document.getElementById(inputId)?.value || '').trim());
        }
      }

      await fetch(SCRIPT_URL, {method:'POST', mode:'no-cors', body:fd});
      statusEl.textContent = 'Submitted! (check sheet)';

      form.reset();
      await paintDropdowns();                // restore placeholders
      try { await refreshCheckins(); } catch {}
    }catch{
      statusEl.textContent = 'Error. Try again or contact the commish.';
    }
  });

  /* =========================
     LIVE CHECK-INS
     - Load from CSV
     - Fast polling for 2 min, then 60s
     ========================= */
  async function refreshCheckins(){
    const rows = await fetchStandings();
    const submitted = new Set(rows.map(r => norm(r.name)));
    renderChips(submitted);
      updateLastUpdatedFromRows(rows);   // <-- add this
    return rows;
  }
  // Fast polling (every 15s) for ~2 minutes, then switch to 60s
  let fastPolls = 0;
  const fastTimer = setInterval(async () => {
    await refreshCheckins();
    if (++fastPolls >= 8) { // ~2 minutes
      clearInterval(fastTimer);
      setInterval(refreshCheckins, 60000); // steady state thereafter
    }
  }, 15000);

  /* =========================
     BOOT
     ========================= */
  (async function init(){
    setRandomTagline();             
    // record week in hidden field
    const weekField = document.getElementById('week-field');
    if (weekField) weekField.value = ACTIVE_WEEK;

    await paintDropdowns();   // load players.json or fallback
    renderChips();            // gray chips first
    loadOptimisticMarks();    // show any local "submitted" marks immediately
    refreshCheckins();        // then sync from the sheet (CSV)
    applyRevealGate();        // show note or standings based on time
  })();
</script>
</body>
</html>







































